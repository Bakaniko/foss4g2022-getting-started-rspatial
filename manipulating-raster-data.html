<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Manipulating raster data | Getting started with R and R-spatial</title>
  <meta name="description" content="Teaching materials for R and R-spatial introduction workshop at FOSS4G2022." />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Manipulating raster data | Getting started with R and R-spatial" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Teaching materials for R and R-spatial introduction workshop at FOSS4G2022." />
  <meta name="github-repo" content="Bakaniko/foss4g2022-getting-started-rspatial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Manipulating raster data | Getting started with R and R-spatial" />
  
  <meta name="twitter:description" content="Teaching materials for R and R-spatial introduction workshop at FOSS4G2022." />
  

<meta name="author" content="Nicolas Roelandt and Jakub Nowosad" />


<meta name="date" content="2022-08-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="manipulating-vector-data.html"/>
<link rel="next" href="summary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<script src="libs/leaflet-graticule-0.1.0/L.Graticule.js"></script>
<script src="libs/leaflet-graticule-0.1.0/Graticule-binding.js"></script>
<link href="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.css" rel="stylesheet" />
<script src="libs/leaflet-minimap-3.3.1/Control.MiniMap.min.js"></script>
<script src="libs/leaflet-minimap-3.3.1/Minimap-binding.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Getting started with R and R-spatial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#schedule"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#pre-requisites"><i class="fa fa-check"></i>Pre-requisites</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#what-is-love-r"><i class="fa fa-check"></i>What is <del>love</del> R ?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-an-r-workshop-in-a-foss4g-conference"><i class="fa fa-check"></i>Why an R workshop in a FOSS4G conference ?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#coding-paradigms"><i class="fa fa-check"></i>Coding paradigms</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html"><i class="fa fa-check"></i><b>1</b> Data handling with R</a><ul>
<li class="chapter" data-level="1.1" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#data-types"><i class="fa fa-check"></i><b>1.1</b> Data types</a></li>
<li class="chapter" data-level="1.2" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#assignment"><i class="fa fa-check"></i><b>1.2</b> Assignment</a></li>
<li class="chapter" data-level="1.3" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#not-only-a-calculator"><i class="fa fa-check"></i><b>1.3</b> Not only a calculator</a></li>
<li class="chapter" data-level="1.4" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#packages"><i class="fa fa-check"></i><b>1.4</b> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#load-data"><i class="fa fa-check"></i><b>1.5</b> Load data</a></li>
<li class="chapter" data-level="1.6" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#in-the-beginning-was-the-verb"><i class="fa fa-check"></i><b>1.6</b> In the beginning was the Verb</a></li>
<li class="chapter" data-level="1.7" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#filter-data"><i class="fa fa-check"></i><b>1.7</b> Filter data</a><ul>
<li class="chapter" data-level="" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#exercice"><i class="fa fa-check"></i>Exercice</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#select-columns"><i class="fa fa-check"></i><b>1.8</b> Select columns</a></li>
<li class="chapter" data-level="1.9" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#create-new-variables"><i class="fa fa-check"></i><b>1.9</b> Create new variables</a></li>
<li class="chapter" data-level="1.10" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#agregate-data"><i class="fa fa-check"></i><b>1.10</b> Agregate data</a><ul>
<li class="chapter" data-level="" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#exercice-1"><i class="fa fa-check"></i>Exercice</a></li>
</ul></li>
<li class="chapter" data-level="1.11" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#join-data"><i class="fa fa-check"></i><b>1.11</b> Join data</a></li>
<li class="chapter" data-level="1.12" data-path="data-handling-with-r.html"><a href="data-handling-with-r.html#piping"><i class="fa fa-check"></i><b>1.12</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rspatial.html"><a href="rspatial.html"><i class="fa fa-check"></i><b>2</b> Introduction to the R-spatial ecosystem</a><ul>
<li class="chapter" data-level="2.1" data-path="rspatial.html"><a href="rspatial.html#rs-spatial-ecosystems"><i class="fa fa-check"></i><b>2.1</b> R’s spatial ecosystem(s)</a></li>
<li class="chapter" data-level="2.2" data-path="rspatial.html"><a href="rspatial.html#vector-data"><i class="fa fa-check"></i><b>2.2</b> Vector data</a></li>
<li class="chapter" data-level="2.3" data-path="rspatial.html"><a href="rspatial.html#raster-data"><i class="fa fa-check"></i><b>2.3</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html"><i class="fa fa-check"></i><b>3</b> Making maps in R</a><ul>
<li class="chapter" data-level="3.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#mapping-tools-in-r"><i class="fa fa-check"></i><b>3.1</b> Mapping tools in R</a></li>
<li class="chapter" data-level="3.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#basic-example"><i class="fa fa-check"></i><b>3.2</b> Basic example</a></li>
<li class="chapter" data-level="3.3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#shapes-and-layers"><i class="fa fa-check"></i><b>3.3</b> Shapes and layers</a></li>
<li class="chapter" data-level="3.4" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#attributes-layers"><i class="fa fa-check"></i><b>3.4</b> Attributes layers</a></li>
<li class="chapter" data-level="3.5" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#other-map-elements"><i class="fa fa-check"></i><b>3.5</b> Other map elements</a></li>
<li class="chapter" data-level="3.6" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#interactive-mode"><i class="fa fa-check"></i><b>3.6</b> Interactive mode</a></li>
<li class="chapter" data-level="3.7" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#saving-maps"><i class="fa fa-check"></i><b>3.7</b> Saving maps</a></li>
<li class="chapter" data-level="3.8" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#what-else"><i class="fa fa-check"></i><b>3.8</b> What else?</a></li>
<li class="chapter" data-level="3.9" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#more-resources"><i class="fa fa-check"></i><b>3.9</b> More resources</a></li>
<li class="chapter" data-level="3.10" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#exercises"><i class="fa fa-check"></i><b>3.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html"><i class="fa fa-check"></i><b>4</b> Manipulating vector data</a><ul>
<li class="chapter" data-level="4.1" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#read-spatial-data"><i class="fa fa-check"></i><b>4.1</b> Read spatial data</a><ul>
<li class="chapter" data-level="4.1.1" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#cycle-hire-dataset"><i class="fa fa-check"></i><b>4.1.1</b> Cycle hire dataset</a></li>
<li class="chapter" data-level="4.1.2" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#boroughs-of-london"><i class="fa fa-check"></i><b>4.1.2</b> Boroughs of London</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#reprojection"><i class="fa fa-check"></i><b>4.2</b> Reprojection</a></li>
<li class="chapter" data-level="4.3" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#joins"><i class="fa fa-check"></i><b>4.3</b> Joins</a><ul>
<li class="chapter" data-level="4.3.1" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#join-by-attributes"><i class="fa fa-check"></i><b>4.3.1</b> Join by attributes</a></li>
<li class="chapter" data-level="4.3.2" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#spatial-join"><i class="fa fa-check"></i><b>4.3.2</b> Spatial join</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#aggregation"><i class="fa fa-check"></i><b>4.4</b> Aggregation</a><ul>
<li class="chapter" data-level="4.4.1" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#count"><i class="fa fa-check"></i><b>4.4.1</b> Count</a></li>
<li class="chapter" data-level="4.4.2" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#sum"><i class="fa fa-check"></i><b>4.4.2</b> Sum</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#centroids"><i class="fa fa-check"></i><b>4.5</b> Centroids</a></li>
<li class="chapter" data-level="4.6" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#geometric-binary-predicates"><i class="fa fa-check"></i><b>4.6</b> Geometric binary predicates</a></li>
<li class="chapter" data-level="4.7" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#saving-results"><i class="fa fa-check"></i><b>4.7</b> Saving results</a><ul>
<li class="chapter" data-level="4.7.1" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#writing-data"><i class="fa fa-check"></i><b>4.7.1</b> Writing data</a></li>
<li class="chapter" data-level="4.7.2" data-path="manipulating-vector-data.html"><a href="manipulating-vector-data.html#check-data"><i class="fa fa-check"></i><b>4.7.2</b> Check data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html"><i class="fa fa-check"></i><b>5</b> Manipulating raster data</a><ul>
<li class="chapter" data-level="5.1" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#example-data"><i class="fa fa-check"></i><b>5.1</b> Example data</a></li>
<li class="chapter" data-level="5.2" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#map-algebra"><i class="fa fa-check"></i><b>5.2</b> Map algebra</a><ul>
<li class="chapter" data-level="5.2.1" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#local-operations"><i class="fa fa-check"></i><b>5.2.1</b> Local operations</a></li>
<li class="chapter" data-level="5.2.2" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#focal-operations"><i class="fa fa-check"></i><b>5.2.2</b> Focal operations</a></li>
<li class="chapter" data-level="5.2.3" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#zonal-operations"><i class="fa fa-check"></i><b>5.2.3</b> Zonal operations</a></li>
<li class="chapter" data-level="5.2.4" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#global-operations"><i class="fa fa-check"></i><b>5.2.4</b> Global operations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#transformations"><i class="fa fa-check"></i><b>5.3</b> Transformations</a><ul>
<li class="chapter" data-level="5.3.1" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#resampling"><i class="fa fa-check"></i><b>5.3.1</b> Resampling</a></li>
<li class="chapter" data-level="5.3.2" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#reprojecting"><i class="fa fa-check"></i><b>5.3.2</b> Reprojecting</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#raster-vector-interactions"><i class="fa fa-check"></i><b>5.4</b> Raster-vector interactions</a><ul>
<li class="chapter" data-level="5.4.1" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#raster-cropping-and-masking"><i class="fa fa-check"></i><b>5.4.1</b> Raster cropping and masking</a></li>
<li class="chapter" data-level="5.4.2" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#raster-extraction"><i class="fa fa-check"></i><b>5.4.2</b> Raster extraction</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#raster-analysis"><i class="fa fa-check"></i><b>5.5</b> Raster analysis</a><ul>
<li class="chapter" data-level="5.5.1" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#predictions"><i class="fa fa-check"></i><b>5.5.1</b> Predictions</a></li>
<li class="chapter" data-level="5.5.2" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#segmentations"><i class="fa fa-check"></i><b>5.5.2</b> Segmentations</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#raster-writing"><i class="fa fa-check"></i><b>5.6</b> Raster writing</a></li>
<li class="chapter" data-level="5.7" data-path="manipulating-raster-data.html"><a href="manipulating-raster-data.html#exercises-1"><i class="fa fa-check"></i><b>5.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="summary.html"><a href="summary.html"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://roelandtn.frama.io/" target="blank">Nicolas Roelandt</a></li>
<li><a href="https://jakubnowosad.com/" target="blank">Jakub Nowosad</a></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Getting started with R and R-spatial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manipulating-raster-data" class="section level1 hasAnchor">
<h1><span class="header-section-number">Chapter 5</span> Manipulating raster data<a href="manipulating-raster-data.html#manipulating-raster-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<!-- (Jakub) Raster data processing (45 min) -->
<p>This chapter requires the following packages:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="manipulating-raster-data.html#cb163-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb163-2"><a href="manipulating-raster-data.html#cb163-2"></a><span class="kw">library</span>(sf)</span>
<span id="cb163-3"><a href="manipulating-raster-data.html#cb163-3"></a><span class="kw">library</span>(terra)</span></code></pre></div>
<div id="example-data" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.1</span> Example data<a href="manipulating-raster-data.html#example-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will read a few datasets for this chapter.
It includes <code>srtm.tif</code> – an elevation raster data the Zion National Park area:
<!-- [](https://geocompr.robinlovelace.net/read-write.html#raster-data-read) --></p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="manipulating-raster-data.html#cb164-1"></a>srtm_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/srtm.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</span>
<span id="cb164-2"><a href="manipulating-raster-data.html#cb164-2"></a>srtm &lt;-<span class="st"> </span><span class="kw">rast</span>(srtm_path)</span></code></pre></div>
<p>We can quickly look at this dataset’s summary by just typing its name:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="manipulating-raster-data.html#cb165-1"></a>srtm</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 457, 465, 1  (nrow, ncol, nlyr)
## resolution  : 0.0008333333, 0.0008333333  (x, y)
## extent      : -113.2396, -112.8521, 37.13208, 37.51292  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : srtm.tif 
## name        : srtm 
## min value   : 1024 
## max value   : 2892</code></pre>
<p>We can also extract each information separately using the following functions:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="manipulating-raster-data.html#cb167-1"></a><span class="kw">ncol</span>(srtm)</span>
<span id="cb167-2"><a href="manipulating-raster-data.html#cb167-2"></a><span class="kw">nrow</span>(srtm)</span>
<span id="cb167-3"><a href="manipulating-raster-data.html#cb167-3"></a><span class="kw">nlyr</span>(srtm)</span>
<span id="cb167-4"><a href="manipulating-raster-data.html#cb167-4"></a><span class="kw">res</span>(srtm)</span>
<span id="cb167-5"><a href="manipulating-raster-data.html#cb167-5"></a><span class="kw">ext</span>(srtm)</span>
<span id="cb167-6"><a href="manipulating-raster-data.html#cb167-6"></a><span class="co">## [1] 465</span></span>
<span id="cb167-7"><a href="manipulating-raster-data.html#cb167-7"></a><span class="co">## [1] 457</span></span>
<span id="cb167-8"><a href="manipulating-raster-data.html#cb167-8"></a><span class="co">## [1] 1</span></span>
<span id="cb167-9"><a href="manipulating-raster-data.html#cb167-9"></a><span class="co">## [1] 0.0008333333 0.0008333333</span></span>
<span id="cb167-10"><a href="manipulating-raster-data.html#cb167-10"></a><span class="co">## SpatExtent : -113.239583212784, -112.85208321281, 37.1320834298579, 37.5129167631658 (xmin, xmax, ymin, ymax)</span></span></code></pre></div>
<p>Next, we can quickly look at the data with the <code>plot()</code> function…</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="manipulating-raster-data.html#cb168-1"></a><span class="kw">plot</span>(srtm)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-5-1.png" width="672" /></p>
<p>… or create more customized map with the {tmap} package:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="manipulating-raster-data.html#cb169-1"></a><span class="kw">tm_shape</span>(srtm) <span class="op">+</span></span>
<span id="cb169-2"><a href="manipulating-raster-data.html#cb169-2"></a><span class="st">  </span><span class="kw">tm_graticules</span>() <span class="op">+</span></span>
<span id="cb169-3"><a href="manipulating-raster-data.html#cb169-3"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">style =</span> <span class="st">&quot;cont&quot;</span>, </span>
<span id="cb169-4"><a href="manipulating-raster-data.html#cb169-4"></a>            <span class="dt">title =</span> <span class="st">&quot;elevation (m a.s.l)&quot;</span>,</span>
<span id="cb169-5"><a href="manipulating-raster-data.html#cb169-5"></a>            <span class="dt">palette =</span> <span class="st">&quot;-Spectral&quot;</span>) <span class="op">+</span></span>
<span id="cb169-6"><a href="manipulating-raster-data.html#cb169-6"></a><span class="st">  </span><span class="kw">tm_scale_bar</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb169-7"><a href="manipulating-raster-data.html#cb169-7"></a>               <span class="dt">text.size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb169-8"><a href="manipulating-raster-data.html#cb169-8"></a><span class="st">  </span><span class="kw">tm_credits</span>(<span class="st">&quot;N. Roelandt and J. Nowosad&quot;</span>) <span class="op">+</span></span>
<span id="cb169-9"><a href="manipulating-raster-data.html#cb169-9"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">inner.margins =</span> <span class="dv">0</span>,</span>
<span id="cb169-10"><a href="manipulating-raster-data.html#cb169-10"></a>            <span class="dt">main.title =</span> <span class="st">&quot;Zion National Park&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-6-1.png" width="672" /></p>
<p>Additional raster dataset we use in this chapter is <code>nlcd.tif</code> – a simplified version of the National Land Cover Database 2011 product for the Zion National Park area.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="manipulating-raster-data.html#cb170-1"></a>nlcd &lt;-<span class="st"> </span><span class="kw">rast</span>(<span class="kw">system.file</span>(<span class="st">&quot;raster/nlcd.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))</span></code></pre></div>
</div>
<div id="map-algebra" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.2</span> Map algebra<a href="manipulating-raster-data.html#map-algebra" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Map algebra is used for a various task related to spatial raster data processing and analysis.</p>
<p>It can be divided into four groups of operations:</p>
<ol style="list-style-type: decimal">
<li><strong>Local</strong> - per-cell operations</li>
<li><strong>Focal</strong> - most often the output cell value is the result of a 3 x 3 input cell block</li>
<li><strong>Zonal</strong> - to summarize raster values for some zones (usually irregular areas)</li>
<li><strong>Global</strong> - to summarize raster values for one or several rasters</li>
</ol>
<div id="local-operations" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.2.1</span> Local operations<a href="manipulating-raster-data.html#local-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Numerical computations are basic examples of local operations – we can create new raster objects by, for example, adding or subtracting existing values:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="manipulating-raster-data.html#cb171-1"></a>srtm2 &lt;-<span class="st"> </span>srtm <span class="op">+</span><span class="st"> </span><span class="dv">1000</span></span>
<span id="cb171-2"><a href="manipulating-raster-data.html#cb171-2"></a>srtm3 &lt;-<span class="st"> </span>srtm <span class="op">-</span><span class="st"> </span><span class="dv">1024</span></span>
<span id="cb171-3"><a href="manipulating-raster-data.html#cb171-3"></a>srtm4 &lt;-<span class="st"> </span>srtm <span class="op">-</span><span class="st"> </span><span class="dv">1837</span></span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-9-1.png" width="100%" /></p>
<p>Another example of local operation is when we want to replace some values.
This can be done by either <code>subst()</code> or <code>classify()</code>.
The <code>subst()</code> function is useful when we want to quickly replace some value(s).</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="manipulating-raster-data.html#cb172-1"></a>srtm_new &lt;-<span class="st"> </span><span class="kw">subst</span>(srtm, <span class="dv">1500</span><span class="op">:</span><span class="dv">2000</span>, <span class="ot">NA</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-11-1.png" width="100%" /></p>
<p>On the other hand, the <code>classify()</code> function is more useful when we want to replace many values.
It requires at least two arguments – our input raster and a reclassification table.
Reclassification table is a matrix usually with two columns (old/new) or three columns (from/to/new):</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="manipulating-raster-data.html#cb173-1"></a>rcl &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="dv">1</span>, <span class="dv">1500</span>, <span class="dv">2000</span>, <span class="dv">2</span>, <span class="dv">2000</span>, <span class="dv">9999</span>, <span class="dv">3</span>),</span>
<span id="cb173-2"><a href="manipulating-raster-data.html#cb173-2"></a>             <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb173-3"><a href="manipulating-raster-data.html#cb173-3"></a>rcl</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    0 1500    1
## [2,] 1500 2000    2
## [3,] 2000 9999    3</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="manipulating-raster-data.html#cb175-1"></a>srtm_recl &lt;-<span class="st"> </span><span class="kw">classify</span>(srtm, <span class="dt">rcl =</span> rcl)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-14-1.png" width="672" /></p>
<p>The last example of local operation is useful when we have many raster layers and want to calculate, for example, spectral indices, such as NDVI.
In this case, each cell’s values are treated independently.</p>
<p>To showcase local operations on many layers, we will use the <code>landsat.tif</code> dataset.
It contains four bands (2, 3, 4, 5) of the Landsat 8 image for the area of Zion National Park.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="manipulating-raster-data.html#cb176-1"></a>landsat_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;raster/landsat.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</span>
<span id="cb176-2"><a href="manipulating-raster-data.html#cb176-2"></a>landsat &lt;-<span class="st"> </span><span class="kw">rast</span>(landsat_path)</span>
<span id="cb176-3"><a href="manipulating-raster-data.html#cb176-3"></a>landsat</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 1428, 1128, 4  (nrow, ncol, nlyr)
## resolution  : 30, 30  (x, y)
## extent      : 301905, 335745, 4111245, 4154085  (xmin, xmax, ymin, ymax)
## coord. ref. : WGS 84 / UTM zone 12N (EPSG:32612) 
## source      : landsat.tif 
## names       : landsat_1, landsat_2, landsat_3, landsat_4 
## min values  :      7550,      6404,      5678,      5252 
## max values  :     19071,     22051,     25780,     31961</code></pre>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-16-1.png" width="672" /></p>
<p><a href="https://en.wikipedia.org/wiki/Normalized_difference_vegetation_index">Normalized Difference Vegetation Index (NDVI)</a> is one of the most commonly used spectral index.
It uses values of two bands: red (3) and near-infrared (4):</p>
<p><span class="math display">\[
\begin{split}
NDVI&amp;= \frac{\text{NIR} - \text{Red}}{\text{NIR} + \text{Red}}\\
\end{split}
\]</span></p>
<p>The above equation can be rewritten as an R function that accepts two arguments, and returns a result of the calculations.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="manipulating-raster-data.html#cb178-1"></a>ndvi_fun &lt;-<span class="st"> </span><span class="cf">function</span>(nir, red){</span>
<span id="cb178-2"><a href="manipulating-raster-data.html#cb178-2"></a>  (nir <span class="op">-</span><span class="st"> </span>red) <span class="op">/</span><span class="st"> </span>(nir <span class="op">+</span><span class="st"> </span>red)</span>
<span id="cb178-3"><a href="manipulating-raster-data.html#cb178-3"></a>}</span></code></pre></div>
<p>Now, we can apply our <code>ndvi_fun()</code> to the <code>lapp()</code> function.
The only important thing we need to remember is to subset our raster to contain only the needed layers:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="manipulating-raster-data.html#cb179-1"></a>ndvi &lt;-<span class="st"> </span><span class="kw">lapp</span>(landsat[[<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">3</span>)]], <span class="dt">fun =</span> ndvi_fun)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-18-1.png" width="672" /></p>
</div>
<div id="focal-operations" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.2.2</span> Focal operations<a href="manipulating-raster-data.html#focal-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Focal operations, also known as moving window operations, apply a function for a given window around each cell.
A numeric vector or a matrix can represent a window.
In the example below, we calculate an average of 3 by 3 cells window for each (focal) cell.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="manipulating-raster-data.html#cb180-1"></a>srtm_focal_mean &lt;-<span class="st"> </span><span class="kw">focal</span>(srtm, <span class="dt">w =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="dt">fun =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-20-1.png" width="672" /></p>
</div>
<div id="zonal-operations" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.2.3</span> Zonal operations<a href="manipulating-raster-data.html#zonal-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Zonal operations are also known as zonal statistics.
They calculate summary statistics independently for each provided “zone” (a category in a second raster), and their result is a summary table.</p>
<p>In this example, we want to calculate an average elevation (from <code>srtm</code>) for each land cover category (from <code>nlcd</code>).
However, firstly we need to have both datasets in the same coordinate reference system.
We can do that with the <code>project()</code> function:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="manipulating-raster-data.html#cb181-1"></a>srtm_utm &lt;-<span class="st"> </span><span class="kw">project</span>(srtm, nlcd, <span class="dt">method =</span> <span class="st">&quot;bilinear&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="manipulating-raster-data.html#cb182-1"></a>srtm_zonal &lt;-<span class="st"> </span><span class="kw">zonal</span>(srtm_utm, nlcd, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">fun =</span> <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb182-2"><a href="manipulating-raster-data.html#cb182-2"></a>srtm_zonal</span></code></pre></div>
<pre><code>##       levels     srtm
## 1      Water 2227.060
## 2  Developed 1699.510
## 3     Barren 1853.950
## 4     Forest 1996.807
## 5  Shrubland 1650.796
## 6 Herbaceous 1644.282
## 7 Cultivated 1288.272
## 8   Wetlands 1262.578</code></pre>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-22-1.png" width="672" /></p>
</div>
<div id="global-operations" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.2.4</span> Global operations<a href="manipulating-raster-data.html#global-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Global operations provide statistics for the entire raster.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="manipulating-raster-data.html#cb184-1"></a><span class="kw">global</span>(srtm, <span class="dt">fun =</span> <span class="st">&quot;mean&quot;</span>)</span></code></pre></div>
<pre><code>##          mean
## srtm 1842.548</code></pre>
</div>
</div>
<div id="transformations" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.3</span> Transformations<a href="manipulating-raster-data.html#transformations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Raster transformations can be, in general, divided into two groups:</p>
<ul>
<li>resampling: recalculating raster values for a different grid (e.g., with a different resolution)</li>
<li>reprojecting: recalculating raster values for a grid with a different coordinate reference system</li>
</ul>
<div id="resampling" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.3.1</span> Resampling<a href="manipulating-raster-data.html#resampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the resampling example, we need a new grid that we will recalculated values into.
Our new grid, <code>new_srtm</code>, will have a lower resolution than the original <code>srtm</code> raster:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="manipulating-raster-data.html#cb186-1"></a>new_srtm &lt;-<span class="st"> </span>srtm</span>
<span id="cb186-2"><a href="manipulating-raster-data.html#cb186-2"></a><span class="kw">res</span>(new_srtm) &lt;-<span class="st"> </span><span class="fl">0.001</span></span>
<span id="cb186-3"><a href="manipulating-raster-data.html#cb186-3"></a>new_srtm</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 381, 387, 1  (nrow, ncol, nlyr)
## resolution  : 0.001, 0.001  (x, y)
## extent      : -113.2396, -112.8526, 37.13208, 37.51308  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326)</code></pre>
<p>Resampling is applied using the <code>resample()</code> function, which accepts the original raster, new (often empty) grid, and a resampling method’s name (e.g., <code>"bilinear"</code>):</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="manipulating-raster-data.html#cb188-1"></a>srtm2 &lt;-<span class="st"> </span><span class="kw">resample</span>(srtm, new_srtm, <span class="dt">method =</span> <span class="st">&quot;bilinear&quot;</span>) <span class="co"># method!</span></span>
<span id="cb188-2"><a href="manipulating-raster-data.html#cb188-2"></a>srtm2</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 381, 387, 1  (nrow, ncol, nlyr)
## resolution  : 0.001, 0.001  (x, y)
## extent      : -113.2396, -112.8526, 37.13208, 37.51308  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## source      : memory 
## name        :    srtm 
## min value   : 1032.44 
## max value   : 2891.25</code></pre>
<p>To learn more about resampling methods, read the <a href="https://geocompr.robinlovelace.net/geometric-operations.html#resampling">Resampling</a> section of Geocomputation with R.</p>
</div>
<div id="reprojecting" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.3.2</span> Reprojecting<a href="manipulating-raster-data.html#reprojecting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Reprojecting moves our raster grid into a new coordinate reference system, and then resample its values.
CRS of the <code>srtm</code> raster is represented by the code <code>"EPSG:4326"</code>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="manipulating-raster-data.html#cb190-1"></a><span class="kw">crs</span>(srtm, <span class="dt">describe =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##     name authority code area         extent
## 1 WGS 84      EPSG 4326 &lt;NA&gt; NA, NA, NA, NA</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="manipulating-raster-data.html#cb192-1"></a><span class="co">#\ echo = FALSE</span></span>
<span id="cb192-2"><a href="manipulating-raster-data.html#cb192-2"></a><span class="co"># hist(srtm)</span></span></code></pre></div>
<p>We can use the <code>project()</code> function to change its CRS.
It expects a raster object (that we want to reproject), a new CRS definition<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>, and a resampling method.
In the example below, we are reprojecting the <code>srtm</code> raster into UTM zone 12N:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="manipulating-raster-data.html#cb193-1"></a>srtm_utm &lt;-<span class="st"> </span><span class="kw">project</span>(srtm, <span class="st">&quot;EPSG:32612&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;bilinear&quot;</span>)</span>
<span id="cb193-2"><a href="manipulating-raster-data.html#cb193-2"></a><span class="kw">crs</span>(srtm_utm, <span class="dt">describe =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##                    name authority  code
## 1 WGS 84 / UTM zone 12N      EPSG 32612
##                                                                                                                                                                                             area
## 1 Between 114°W and 108°W, northern hemisphere between equator and 84°N, onshore and offshore. Canada - Alberta; Northwest Territories (NWT); Nunavut; Saskatchewan. Mexico. United States (USA)
##              extent
## 1 -114, -108, 84, 0</code></pre>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-33-1.png" width="672" /></p>
<!-- https://projectionwizard.org/ -->
</div>
</div>
<div id="raster-vector-interactions" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.4</span> Raster-vector interactions<a href="manipulating-raster-data.html#raster-vector-interactions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Raster and vector datasets can interact in many ways.
It includes:</p>
<ul>
<li>raster cropping and masking by vector polygons</li>
<li>extraction of raster values by vector points, lines, and polygons</li>
<li>rasterization: converting vector points, lines, polygons to rasters</li>
<li>vectorization: converting rasters to polygons or contours</li>
</ul>
<p>Here, we will focus only on raster cropping and masking, and raster extraction by points.
Read the <a href="https://geocompr.robinlovelace.net/raster-vector.html">raster-vector interactions</a> chapter of the Geocomputation with R book to learn more.</p>
<div id="raster-cropping-and-masking" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.4.1</span> Raster cropping and masking<a href="manipulating-raster-data.html#raster-cropping-and-masking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example, our goal is to limit the raster data to the area of a polygon.
Therefore, we need to read our polygon dataset, <code>zion.gpkg</code>, representing the borders of Zion National Park:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="manipulating-raster-data.html#cb195-1"></a>zion &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="kw">system.file</span>(<span class="st">&quot;vector/zion.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))</span></code></pre></div>
<p>Raster cropping (<code>crop()</code>) limits the raster data (first argument) extent to the bounding box of the vector data (second argument).</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="manipulating-raster-data.html#cb196-1"></a>srtm_utm_c &lt;-<span class="st"> </span><span class="kw">crop</span>(srtm_utm, zion)</span></code></pre></div>
<p>Raster masking (<code>mask()</code>) is usually done together with cropping.
This operation replaces values of all the cells outside the polygon to <code>NA</code>:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="manipulating-raster-data.html#cb197-1"></a>srtm_utm_m &lt;-<span class="st"> </span><span class="kw">mask</span>(srtm_utm_c, zion)</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-39-1.png" width="672" /></p>
</div>
<div id="raster-extraction" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.4.2</span> Raster extraction<a href="manipulating-raster-data.html#raster-extraction" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Raster extraction allows to get value(s) of raster cells based on vector data locations.
For this example, we will use 30 points located in Zion National Park stored in the <code>zion_points.gpkg</code> file:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="manipulating-raster-data.html#cb198-1"></a>zion_points &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="kw">system.file</span>(<span class="st">&quot;vector/zion_points.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/06-manipulating-raster-data-41-1.png" width="672" /></p>
<p>The <code>extract()</code> function returns a data frame where the <code>ID</code> column represents each vector feature (a point in this case), and the rest of the columns store extracted values.
Next, we can connect the extracted values with the vector object using the <code>cbind()</code> function:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="manipulating-raster-data.html#cb199-1"></a>zion_extract &lt;-<span class="st"> </span>terra<span class="op">::</span><span class="kw">extract</span>(srtm, zion_points)</span>
<span id="cb199-2"><a href="manipulating-raster-data.html#cb199-2"></a>zion_points &lt;-<span class="st"> </span><span class="kw">cbind</span>(zion_points, zion_extract)</span>
<span id="cb199-3"><a href="manipulating-raster-data.html#cb199-3"></a>zion_points</span></code></pre></div>
<pre><code>## Simple feature collection with 30 features and 2 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -113.2077 ymin: 37.16632 xmax: -112.8717 ymax: 37.43165
## Geodetic CRS:  WGS 84
## First 10 features:
##    ID srtm                       geom
## 1   1 1802 POINT (-112.9159 37.20013)
## 2   2 2433 POINT (-113.0937 37.39263)
## 3   3 1886 POINT (-113.0246 37.33466)
## 4   4 1370 POINT (-112.9611 37.24326)
## 5   5 1452 POINT (-112.9898 37.20847)
## 6   6 1635 POINT (-112.8807 37.19319)
## 7   7 1380 POINT (-113.0505 37.24061)
## 8   8 2032 POINT (-113.0953 37.34965)
## 9   9 1830 POINT (-113.0362 37.31429)
## 10 10 1860 POINT (-113.2077 37.43165)</code></pre>
<!-- exact = TRUE -->
</div>
</div>
<div id="raster-analysis" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.5</span> Raster analysis<a href="manipulating-raster-data.html#raster-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are many ways to analyze raster data, with some directly implemented in {terra}, while other available in external R packages.
Here, we will show to basic examples of – spatial model predictions and spatial segmentation.</p>
<div id="predictions" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.5.1</span> Predictions<a href="manipulating-raster-data.html#predictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this example, we will use <code>lsl_sf</code> and <code>ta</code> datasets:
- <code>lsl_sf</code>: spatial vector object with several variables, such as <code>lslpts</code> (where TRUE corresponds to an observed landslide ‘initiation point’), <code>slope</code>, <code>cplan</code> (plan curvature), <code>cprof</code> (profile curvature), <code>elev</code> (elevation), <code>log10_carea</code> (catchment area)
- <code>ta</code>: spatial raster object with the same variables, except <code>lslpts</code></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="manipulating-raster-data.html#cb201-1"></a><span class="kw">data</span>(<span class="st">&quot;lsl&quot;</span>, <span class="st">&quot;study_mask&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>)</span>
<span id="cb201-2"><a href="manipulating-raster-data.html#cb201-2"></a>lsl_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(lsl, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), <span class="dt">crs =</span> <span class="st">&quot;EPSG:32717&quot;</span>)</span>
<span id="cb201-3"><a href="manipulating-raster-data.html#cb201-3"></a>ta &lt;-<span class="st"> </span>terra<span class="op">::</span><span class="kw">rast</span>(<span class="kw">system.file</span>(<span class="st">&quot;raster/ta.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))</span>
<span id="cb201-4"><a href="manipulating-raster-data.html#cb201-4"></a>ta &lt;-<span class="st"> </span><span class="kw">mask</span>(ta, study_mask)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Our main goal here is to predict landslide susceptibility based on the available data.
One possible approach here would be to use Generalized Linear Models (GLM):</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="manipulating-raster-data.html#cb202-1"></a>fit &lt;-<span class="st"> </span><span class="kw">glm</span>(lslpts <span class="op">~</span><span class="st"> </span>slope <span class="op">+</span><span class="st"> </span>cplan <span class="op">+</span><span class="st"> </span>cprof <span class="op">+</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>log10_carea,</span>
<span id="cb202-2"><a href="manipulating-raster-data.html#cb202-2"></a>          <span class="dt">family =</span> <span class="kw">binomial</span>(), <span class="dt">data =</span> lsl_sf)</span></code></pre></div>
<p>Next, we can use our model, <code>fit</code>, to predict landslide susceptibility for the whole study area with the <code>predict()</code> function:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="manipulating-raster-data.html#cb203-1"></a>pred &lt;-<span class="st"> </span><span class="kw">predict</span>(ta, <span class="dt">model =</span> fit, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Visit the <code>predict()</code> function help file, <code>?predict</code>, for more examples of spatial model predictions using {terra}.
You can also read about an extended example of spatial prediction in the <a href="https://geocompr.robinlovelace.net/spatial-cv.html">Statistical learning</a> chapter of Geocomputation with R.</p>
</div>
<div id="segmentations" class="section level3 hasAnchor">
<h3><span class="header-section-number">5.5.2</span> Segmentations<a href="manipulating-raster-data.html#segmentations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Segmentation is a partition of space to identify homogeneous objects.
One possible approach to create segments using the SLIC Superpixel algorithm through the {supercells} package.
The example data here is an RGB raster with 87,400 cells.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="manipulating-raster-data.html#cb204-1"></a><span class="kw">library</span>(supercells)</span>
<span id="cb204-2"><a href="manipulating-raster-data.html#cb204-2"></a>ortho &lt;-<span class="st"> </span><span class="kw">rast</span>(<span class="kw">system.file</span>(<span class="st">&quot;raster/ortho.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;supercells&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Superpixels can be created with the <code>supercells()</code> function that expects our input raster and several parameters:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="manipulating-raster-data.html#cb205-1"></a>ortho_slic1 &lt;-<span class="st"> </span><span class="kw">supercells</span>(ortho, <span class="dt">k =</span> <span class="dv">2000</span>, <span class="dt">compactness =</span> <span class="dv">10</span>, <span class="dt">transform =</span> <span class="st">&quot;to_LAB&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Each superpixel represents a desired level of homogeneity while at the same time maintains boundaries and structures.
Superpixels also carry more information than each cell alone, and thus they can speed up the subsequent processing efforts.</p>
<p>Next, to vizualize our results we can convert average colors of each superpixel from RGB to a hexadecimal representation:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="manipulating-raster-data.html#cb206-1"></a>rgb_to_hex &lt;-<span class="st"> </span><span class="cf">function</span>(x){</span>
<span id="cb206-2"><a href="manipulating-raster-data.html#cb206-2"></a>  <span class="kw">apply</span>(<span class="kw">t</span>(x), <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="kw">rgb</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>], <span class="dt">maxColorValue =</span> <span class="dv">255</span>))</span>
<span id="cb206-3"><a href="manipulating-raster-data.html#cb206-3"></a>}</span>
<span id="cb206-4"><a href="manipulating-raster-data.html#cb206-4"></a>avg_colors &lt;-<span class="st"> </span><span class="kw">rgb_to_hex</span>(<span class="kw">st_drop_geometry</span>(ortho_slic1[<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>]))</span>
<span id="cb206-5"><a href="manipulating-raster-data.html#cb206-5"></a><span class="co"># plot(ortho)</span></span>
<span id="cb206-6"><a href="manipulating-raster-data.html#cb206-6"></a><span class="co"># plot(st_geometry(ortho_slic1), add = TRUE, col = avg_colors)</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>You can watch the <a href="https://av.tib.eu/media/54880">Spatial segmentation in R using the supercells package</a> presentation (<a href="https://jakubnowosad.com/ogh2021/">slides</a>) to learn more about the {supercells} package.
We also encourage you to visit <a href="https://cran.r-project.org/view=Spatial" class="uri">https://cran.r-project.org/view=Spatial</a> and <a href="https://cran.r-project.org/package=terra" class="uri">https://cran.r-project.org/package=terra</a> to find other packages allowing for spatial raster data analysis.</p>
</div>
</div>
<div id="raster-writing" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.6</span> Raster writing<a href="manipulating-raster-data.html#raster-writing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Writing raster objects back to the files is possible with <code>writeRaster()</code>.
It allows, for example, to provide GDAL driver-specific creation options (<code>gdal</code>), output data type (<code>datatype</code>), or file type (<code>filetype</code>):</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="manipulating-raster-data.html#cb207-1"></a><span class="kw">writeRaster</span>(nlcd, <span class="dt">filename =</span> <span class="st">&quot;nlcd0.tif&quot;</span>)</span>
<span id="cb207-2"><a href="manipulating-raster-data.html#cb207-2"></a><span class="kw">writeRaster</span>(nlcd, <span class="dt">filename =</span> <span class="st">&quot;nlcd1.tif&quot;</span>, <span class="dt">gdal =</span> <span class="kw">c</span>(<span class="st">&quot;COMPRESS=NONE&quot;</span>))</span>
<span id="cb207-3"><a href="manipulating-raster-data.html#cb207-3"></a><span class="kw">writeRaster</span>(nlcd, <span class="dt">filename =</span> <span class="st">&quot;nlcd2.tif&quot;</span>, <span class="dt">datatype =</span> <span class="st">&quot;INT1U&quot;</span>)</span>
<span id="cb207-4"><a href="manipulating-raster-data.html#cb207-4"></a><span class="kw">writeRaster</span>(nlcd, <span class="dt">filename =</span> <span class="st">&quot;nlcd3.tif&quot;</span>, <span class="dt">filetype =</span> <span class="st">&quot;COG&quot;</span>)</span></code></pre></div>
<p>To learn more about raster writing visit the <a href="https://geocompr.robinlovelace.net/read-write.html#data-output">Geocomputation with R</a> book and the <a href="https://gdal.org/drivers/raster/gtiff.html">official GDAL</a> documentation.</p>
</div>
<div id="exercises-1" class="section level2 hasAnchor">
<h2><span class="header-section-number">5.7</span> Exercises<a href="manipulating-raster-data.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Read the following datasets:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="manipulating-raster-data.html#cb208-1"></a>nz_elev &lt;-<span class="st"> </span><span class="kw">rast</span>(<span class="kw">system.file</span>(<span class="st">&quot;raster/nz_elev.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))</span>
<span id="cb208-2"><a href="manipulating-raster-data.html#cb208-2"></a><span class="kw">data</span>(<span class="st">&quot;nz&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spData&quot;</span>)</span>
<span id="cb208-3"><a href="manipulating-raster-data.html#cb208-3"></a><span class="kw">data</span>(<span class="st">&quot;nz_height&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spData&quot;</span>)</span></code></pre></div>
<p>E1. Create a map of <code>nz_elev</code> (raster), <code>nz</code> (polygon), and <code>nz_height</code> (point) datasets.</p>
<p>E2. Reclassify the <code>nz_elev</code> into three groups of values: below 300 (as <code>1</code>), between 300 and 600 (as <code>2</code>), and above 600 m asl (as <code>3</code>).</p>
<p>E3. Extract average elevation for each of the New Zealand region (Hints: read about the <code>fun</code> argument of <code>?terra::extract</code>; you will also need to add <code>na.rm = TRUE</code> to your function call).
Which region has the highest average elevation?
Plot the results.</p>
<p>E4. Calculate the GNDVI index (see its equation at <a href="https://bleutner.github.io/RStoolbox/rstbx-docu/spectralIndices.html" class="uri">https://bleutner.github.io/RStoolbox/rstbx-docu/spectralIndices.html</a>) based on the <code>landsat</code> dataset.
Compare the obtained values of GNDVI with the previously calculated values of NDVI.</p>
<p>E5. Bonus: see the documentation of the <code>shade()</code> function, <code>?shade</code>, and try to create a hillshade map of New Zealand.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="5">
<li id="fn5"><p>This can also be a raster with a different CRS.<a href="manipulating-raster-data.html#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="manipulating-vector-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Bakaniko/foss4g2022-getting-started-rspatial/edit/main/06-manipulating-raster-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
